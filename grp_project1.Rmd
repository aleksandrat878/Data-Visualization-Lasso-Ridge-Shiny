---
title: "Group Project part 1"
author:
- Aleksandra Tatko (8022399)
- Clarine Schornagel (7551010)
- Nikita Smirnov (0399515)
- Filippo Sallustio (8858926)
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    toc_depth: '3'
  html_document:
    theme: darkly
    toc: yes
    toc_depth: 3
    highlight: tango
---

```{r setup, include = FALSE, message = FALSE}
knitr::opts_chunk$set(comment = "", warning = FALSE, message = FALSE, erro=T)
```

# 1. Introduction

The aim of this project is to analyze a dataset of popular songs from Spotify to investigate the hypothesis that the music vibe, particularly the danceability of songs, has remained consistent over the years. The dataset, sourced from Kaggle and titled ["Spotify - Top 2000"](https://www.kaggle.com/datasets/iamsumat/spotify-top-2000s-mega-dataset), includes a range of features such as year of release, beats per minute (BPM), danceability, and popularity, among others. 

For our research, we focused on the variables year of release, BPM, danceability, and popularity. We began our analysis by cleaning the dataset and extracting the relevant variables to streamline the subsequent analysis. To facilitate our research, we grouped the years into decades and identified the most popular genre for each decade. This categorization helped us establish a foundation for analyzing trends in danceability over time and to test our hypothesis comprehensively.

 
```{r}
# read the file and then show top 10 rows just to check if everything works fine
library(dplyr)
library(readr)

spoty <- read_csv("Spotify-2000.csv")
head(spoty, 10)
```


```{r, include=FALSE}
# clean the data and create new cleaned dataset with all the needed variables
cleaned_spoty <- spoty %>%
  select(`Top Genre`, Year, `Beats Per Minute (BPM)`, Danceability, Popularity) %>%
  filter(!is.na(`Top Genre`), !is.na(Year), !is.na(Danceability), !is.na(`Beats Per Minute (BPM)`), !is.na(Popularity))

cleaned_spoty <- cleaned_spoty %>%
  rename(Genre = `Top Genre`)
```

```{r}
# Creating a new column 'Decade' to categorize each year into decades
cleaned_spoty <- cleaned_spoty %>%
  mutate(Decade = floor(Year / 10) * 10)

# Find the most popular genre for each decade
most_popular_genre <- cleaned_spoty %>%
  group_by(Decade, Genre) %>%
  summarise(Average_Popularity = mean(Popularity, na.rm = TRUE)) %>%
  arrange(Decade, desc(Average_Popularity)) %>%
  slice(1) %>%
  ungroup()

# Rename the columns for clarity
most_popular_genre <- most_popular_genre %>%
  rename(Most_Popular_Genre = Genre, Most_Popular_Genre_Avg_Popularity = Average_Popularity)

# Join the most popular genre back to the original dataset
cleaned_spoty <- cleaned_spoty %>%
  left_join(most_popular_genre, by = "Decade")

# View the updated dataset
head(cleaned_spoty)
```

---

# 2. Visualization

To understand the structure of our data and identify any potential trends, we started with the following visualization that shows genres and their popularity in each decade. This visualization serves as a foundational step in testing our hypothesis that "The music vibe hasnâ€™t changed over the years," specifically focusing on danceability. By first identifying the most popular genres in each decade and their popularity, we set the stage for a deeper analysis into whether the danceability of songs within these genres has remained consistent over time.


```{r graph 1}
# graphs start here
library(dplyr)
library(ggplot2)

ggplot(most_popular_genre, aes(x = Decade, y = Most_Popular_Genre_Avg_Popularity)) +
  geom_segment(aes(x = Decade, xend = Decade + 10, y = Most_Popular_Genre_Avg_Popularity, yend = Most_Popular_Genre_Avg_Popularity, color = Most_Popular_Genre), size = 4) +
  labs(title = "Most Popular Genre's Average Popularity Over the Past 7 Decades",
       x = "Decade",
       y = "Average Popularity",
       color = "Genre") +
  scale_x_continuous(breaks = seq(min(most_popular_genre$Decade), max(most_popular_genre$Decade) + 10, by = 10), 
                     limits = c(min(most_popular_genre$Decade), 2020)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(size = 12, face = "bold", hjust = 0.5))

```

The graph indicates that while the most popular genre varies across decades, the average popularity scores remain relatively stable, providing a preliminary insight that the music vibe, as measured by popularity, has not drastically shifted. The next steps will involve a detailed analysis of the danceability scores within these genres across the decades to further substantiate our hypothesis.

---

As our next step, we decided to examine the average BPM and danceability of popular songs over several decades to further investigate our hypothesis. The graphs of Average BPM and Average Danceability over the years provide valuable insights. Both graphs reveal significant fluctuations in the 1960s, with the average BPM and danceability scores showing considerable variability. However, from the 1970s onwards, these trends stabilize.


```{r graph 2}
average_bpm_per_year <- cleaned_spoty %>%
  group_by(Year) %>%
  summarise(Average_BPM = mean(`Beats Per Minute (BPM)`, na.rm = TRUE))

ggplot(average_bpm_per_year, aes(x = Year, y = Average_BPM)) +
  geom_line(color = "red", size = 0.7) + 
  labs(title = "Average BPM Over the Years",
       x = "Year",
       y = "Average BPM") +
  scale_x_continuous(breaks = seq(1950, 2020, by = 10)) + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "gray90"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', colour = "gray60"),
    panel.border = element_rect(color = "gray60", fill = NA, size = 0.5)
  )


```

The Average BPM graph indicates that from the 1970s, BPM values maintain a relatively consistent range, fluctuating around 120 BPM with only minor variations. This suggests that the tempo of popular music has remained fairly stable over the decades, with no clear upward or downward trend.

```{r graph 3}
library(dplyr)
library(ggplot2)

average_danceability_per_year <- cleaned_spoty %>%
  group_by(Year) %>%
  summarise(Average_Danceability = mean(Danceability, na.rm = TRUE))

ggplot(average_danceability_per_year, aes(x = Year, y = Average_Danceability)) +
  geom_line(color = "#0082C2", size = 0.8) + 
  labs(title = "Average Danceability Over the Years",
       x = "Year",
       y = "Average Danceability") +
  scale_x_continuous(breaks = seq(1950, 2020, by = 10)) + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),  
    axis.text.y = element_text(size = 10),  
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5), 
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "gray90"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', colour = "gray60"),
    panel.border = element_rect(color = "gray60", fill = NA, size = 0.5))

```

On the other hand, the Average Danceability graph shows a general upward trend from the 1970s onwards, stabilizing around a danceability score of 60. While there are some minor peaks and troughs, the overall trend indicates a slight increase in danceability over time. However, these changes are not drastic, further supporting the notion that the core aspects of the music vibe, particularly tempo and danceability, have remained relatively consistent over the years.

---
 
# 3. Linear Regression

As the last step in our analysis, we sought to determine the significance of our findings by performing linear regression to assess whether the Decade variable significantly affects Danceability. If the coefficients for the Decade variable are not significantly different from zero, it would suggest that the music vibe, as measured by Danceability, has not changed significantly over the years.

We split the data into training and test sets and performed both Lasso and Ridge regression. The Mean Squared Error (MSE) for both models was relatively similar, with the Ridge Regression MSE being 221.85 and the Lasso Regression MSE being 221.51. This similarity in MSE indicates that the models are performing comparably, and there is no significant difference in predictive performance between the two methods.

Both Ridge and Lasso regression analyses yielded coefficients for the Decade variable that were not significantly different from zero. This outcome suggests that the music vibe, as measured by Danceability, has remained relatively stable over the years. Consequently, our hypothesis that the music vibe has not changed significantly over time is supported by the regression analysis, as there are no substantial shifts in Danceability attributable to different decades.


```{r}
library(glmnet)
library(gridExtra)
library(caret)

# Prepare the data for regression
cleaned_spoty$Decade <- as.factor(cleaned_spoty$Decade)

# Create model matrix for regression
X <- model.matrix(Danceability ~ Decade, data = cleaned_spoty)[, -1]
y <- cleaned_spoty$Danceability

# Split data into training and test sets
set.seed(123)
trainIndex <- createDataPartition(y, p = 0.7, list = FALSE)
X_train <- X[trainIndex, ]
X_test <- X[-trainIndex, ]
y_train <- y[trainIndex]
y_test <- y[-trainIndex]

# Ridge Regression
ridge_model <- cv.glmnet(X_train, y_train, alpha = 0)
ridge_best_lambda <- ridge_model$lambda.min
plot(ridge_model)

# Predict and evaluate
ridge_predictions <- predict(ridge_model, s = ridge_best_lambda, newx = X_test)
ridge_mse <- mean((ridge_predictions - y_test)^2)
print(paste("Ridge Regression MSE:", ridge_mse))

# Coefficients
ridge_coef <- coef(ridge_model, s = ridge_best_lambda)
print("Ridge Regression Coefficients:")
print(ridge_coef)

# Lasso Regression
lasso_model <- cv.glmnet(X_train, y_train, alpha = 1)
lasso_best_lambda <- lasso_model$lambda.min
plot(lasso_model)

# Predict and evaluate
lasso_predictions <- predict(lasso_model, s = lasso_best_lambda, newx = X_test)
lasso_mse <- mean((lasso_predictions - y_test)^2)
print(paste("Lasso Regression MSE:", lasso_mse))

# Coefficients
lasso_coef <- coef(lasso_model, s = lasso_best_lambda)
print("Lasso Regression Coefficients:")
print(lasso_coef)
```

# 4. Conclusion

In conclusion, our analysis supports the hypothesis that the music vibe, specifically the danceability of songs, has remained consistent over the decades. Through the use of visualizations and regression analysis, we observed that while there are some fluctuations in BPM and danceability scores, especially in the 1960s, these trends stabilize from the 1970s onwards. The regression analysis further confirmed that the Decade variable does not significantly affect Danceability, indicating no substantial change in the music vibe over time.

These findings suggest that the core aspects of music that contribute to its danceability have remained stable, despite changes in genre popularity and other musical elements. This stability can be valuable information for music producers and artists aiming to understand long-term trends in music preferences. Future research could expand on this analysis by incorporating additional variables and exploring non-linear relationships to gain a more comprehensive understanding of trends in music characteristics over time.

# 5. Appendix
The responsibilities of each group member:
Nikita Smirnov: cleaning the data, choosing the research question, preparing the files;
Clarine Schornagel: Creating the graphs for data visulization;
Filippo Sallustio: Creating the linear regression graphs;
Aleksandra Tatko: Writing the report.